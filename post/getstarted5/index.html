<!DOCTYPE html>
<html>
  <head>
    <title>はじめてのPythonMOD 5  &middot; Kujira, Civ4 Mod Blog</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="はじめてのPythonMOD, 講座, ">


<meta property="og:title" content="はじめてのPythonMOD 5  &middot; Kujira, Civ4 Mod Blog ">
<meta property="og:site_name" content="Kujira, Civ4 Mod Blog"/>
<meta property="og:url" content="https://gforestshade.github.io/kujira/post/getstarted5/" />
<meta property="og:locale" content="ja-JP">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2017-07-30T00:00:00Z" />
<meta property="og:article:modified_time" content="2017-07-30T00:00:00Z" />

  
    
<meta property="og:article:tag" content="はじめてのPythonMOD">
    
<meta property="og:article:tag" content="講座">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="はじめてのPythonMOD 5" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://gforestshade.github.io/kujira/post/getstarted5/" />
<meta name="twitter:domain" content="https://gforestshade.github.io/kujira/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "はじめてのPythonMOD 5",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2017-07-30",
    "description": "",
    "wordCount":  3331 
  }
</script>



<link rel="canonical" href="https://gforestshade.github.io/kujira/post/getstarted5/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://gforestshade.github.io/touch-icon-144-precomposed.png">
<link href="https://gforestshade.github.io/favicon.ico" rel="icon">

<meta name="generator" content="Hugo 0.62.2" />

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous" />
<link href="https://stackpath.bootstrapcdn.com/bootswatch/4.1.0/materia/bootstrap.min.css" rel="stylesheet" integrity="sha384-BJWCnw/x/9+kQsLGLQDoCX2oJg7j1LjkOfPZWtUPTJ0tn00hYIB5r9u7KnGJxFnY" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night-eighties.min.css" />
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

<link rel="stylesheet" href="https://gforestshade.github.io/kujira/css/style.css" />


    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-111798374-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </head>

    <body id="index" class="archive">
      <nav class="navbar navbar-expand-md navbar-dark px-5 navbar-color">
        <a class="navbar-brand" href="https://gforestshade.github.io/kujira/">Kujira, Civ4 Mod Blog</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse"
                data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false"
                aria-label="Toggle navigation">
          &#9776;
        </button>
        <div class="mx-md-4"></div>
        <div class="collapse navbar-collapse" id="navbarNav">
          <div class="nav navbar-nav">
            
            
              <a class="nav-item nav-link menu-item mx-md-2" href="https://gforestshade.github.io/kujira/post/hajimeni/">
              <i class='fa fa-star'></i>
              <span>はじめに</span>
              </a>
            
              <a class="nav-item nav-link menu-item mx-md-2" href="https://gforestshade.github.io/kujira/page/license/">
              <i class='fa fa-file'></i>
              <span>LICENSE</span>
              </a>
            
          </div>
        </div>
      </nav>
      <div class="m-3"></div>

<div id="whole">
  <div class="leftbar">
    




<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a class="collapsed" data-toggle="collapse" href="#collist_0" role="button">目次</a></h5>
  </div>
  <div role="tabpanel" id="collist_0" class="collapse show">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/hajimeni/">はじめに</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a class="collapsed" data-toggle="collapse" href="#collist_1" role="button">Python</a></h5>
  </div>
  <div role="tabpanel" id="collist_1" class="collapse show">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted1/">はじめてのPythonMOD 1</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted2/">はじめてのPythonMOD 2</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted3/">はじめてのPythonMOD 3</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted4/">はじめてのPythonMOD 4</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted5/">はじめてのPythonMOD 5</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted6/">はじめてのPythonMOD 6</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted7/">はじめてのPythonMOD 7</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy1/">それからのPython 1</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy2/">それからのPython 2</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy3/">それからのPython 3</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy4/">それからのPython 4</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy5/">それからのPython 5</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy6/">それからのPython 6</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy7/">それからのPython 7</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy8/">それからのPython 8</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy9/">それからのPython 9</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy10/">それからのPython 10</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a data-toggle="collapse" href="#collist_2" role="button">XML</a></h5>
  </div>
  <div role="tabpanel" id="collist_2" class="collapse">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4unitinfos/">CIV4UnitInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4unitclassinfos/">CIV4UnitClassInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4buildinginfos/">CIV4BuildingInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/keyichiran/">XMLキー一覧_new</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4leaderheadinfos/">CIV4LeaderHeadInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4civilizationinfos/">Civ4CivilizationInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4civicinfos/">Civ4CivicInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/glossary/">用語集</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4techinfos/">Civ4TechInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4traitinfos/">Civ4TraitInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4buildingclassinfos/">CIV4BuildingClassInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4promotioninfos/">CIV4PromotionInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4projectinfos/">CIV4ProjectInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4handicapinfo/">CIV4HandicapInfo.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4bonusinfos/">CIV4BonusInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4improvementinfos/">CIV4ImprovementInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4gamespeedinfo/">CIV4GameSpeedInfo.xml</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a data-toggle="collapse" href="#collist_3" role="button">C&#43;&#43;</a></h5>
  </div>
  <div role="tabpanel" id="collist_3" class="collapse">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/howtocompile/">CvGameCoreDll.dllの作り方(2018-02)</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/howtocompiledoc/">CvGameCoreDll.dllの作り方(2018-05)</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a data-toggle="collapse" href="#collist_4" role="button">コラム</a></h5>
  </div>
  <div role="tabpanel" id="collist_4" class="collapse">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/power/">通常電力、きたない電力</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/movement/">移動力と地形コスト</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/irrigation/">灌漑</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a data-toggle="collapse" href="#collist_5" role="button">MMD_to_CIV4</a></h5>
  </div>
  <div role="tabpanel" id="collist_5" class="collapse">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/mmd_to_nif/">MMDモデルをCiv4に登場させたい</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/nifanimation/">MMDモデルをCiv4上で動かしたい</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



 







  </div>
  <div class="centerbar">
    <div class="container-fluid">
            <div class="card card-body my-3">
        <div class="article-title">
          

  
    
    
      
    
      
          <a href="https://gforestshade.github.io/kujira/post/getstarted5/" itemprop="url">
            <img src="https://gforestshade.github.io/kujira/banner/photo_yellow1_1024x200.jpg" class="img-fluid border rounded" alt="Generic responsive image">
          </a>
          
            <p class="banner-license">banner: <a href="https://www.flickr.com/photos/132803717@N02/27004253005/">&lsquo;Choice&rsquo; by Seán Mackey</a> (トリミング) under a <a href="https://creativecommons.org/licenses/by/2.0/deed.ja">Creative Commons Attribution 2.0</a>.</p>
          
      
    
      
    
      
    
      
    
  
  <div class="py-3" ></div>


          <h1 class="article-title">はじめてのPythonMOD 5</h1>
        </div>
        <div class="article-info text-muted d-flex flex-wrap align-items-center align-items-end flex-row justify-content-end mt-1 mb-3">
          <p><time datetime="2017-07-30">2017-07-30 00:00</time></p>
          
          <p>3331  Words</p>
          
          

          
          <p>
            カテゴリ：
            
            <a class="btn btn-sm btn-outline-primary" href="https://gforestshade.github.io/kujira/categories/python">Python</a>
            
          </p>
          

          
          <p>
            タグ：
            
            <a class="btn btn-sm btn-outline-info" href="https://gforestshade.github.io/kujira/tags/%e3%81%af%e3%81%98%e3%82%81%e3%81%a6%e3%81%aepythonmod">はじめてのPythonMOD</a>
            
            <a class="btn btn-sm btn-outline-info" href="https://gforestshade.github.io/kujira/tags/%e8%ac%9b%e5%ba%a7">講座</a>
            
          </p>
          
        </div>
        <div class="article">
          <h1 id="はじめに">はじめに</h1>
<ul>
<li><a href="https://gforestshade.github.io/kujira/post/getstarted4/">その４</a>のつづき</li>
<li>リストと繰り返し</li>
<li>他のイベント</li>
</ul>
<h1 id="今日のmod">今日のMOD</h1>
<h2 id="準備">準備</h2>
<p>例によって<code>kujira_for</code>というMODを作ります。<br>
<code>kujira_if</code>をフォルダごとコピーして、フォルダ名をリネームしましょう。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">└─kujira_for
    └─Assets
        └─Python
            │─KujiraEventManager.py
            │
            └─Entrypoints
                 └─CvEventInterface.py
</code></pre></div><h2 id="構想">構想</h2>
<p>《建造物が建設されたとき、その建造物がダンならば、<br>
　都市と同じタイル上にいる全ユニットに教練Ⅰと教練Ⅱを与えるMOD》<br>
を作りましょう。<br>
捕まえるイベントをいつもと変えているほか、ユニットへの操作を入れています。</p>
<p>バニラの建造物によくある<br>
「この都市で生産されたユニットに教練Ⅰと教練Ⅱ」<br>
との違いに注意してください。<br>
今作ろうとしているのはダンが建設完了したその瞬間に<br>
都市直上にいたユニットに影響を与える一回限りの即時的な効果です。</p>
<h2 id="建造物が建設されたとき">建造物が建設されたとき</h2>
<p>KujiraEventManager.pyをこのようにします&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> CvPythonExtensions <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#f92672">import</span> CvEventManager
<span style="color:#f92672">import</span> CvUtil

gc <span style="color:#f92672">=</span> CyGlobalContext()

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyEventManager</span>(CvEventManager<span style="color:#f92672">.</span>CvEventManager, object):

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">onBuildingBuilt</span>(self, argsList):
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Called when a building is built</span><span style="color:#e6db74">&#39;</span>
        super(self<span style="color:#f92672">.</span>__class__, self)<span style="color:#f92672">.</span>onBuildingBuilt(argsList)
        <span style="color:#75715e">##########</span>
        CvUtil<span style="color:#f92672">.</span>pyPrint(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">onBuildingBuilt: called</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><p>前回からの変更点はこの部分です&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">onBuildingBuilt</span>(self, argsList):
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Called when a building is built</span><span style="color:#e6db74">&#39;</span>
    super(self<span style="color:#f92672">.</span>__class__, self)<span style="color:#f92672">.</span>onBuildingBuilt(argsList)
<span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span>
</code></pre></div><p><code>onCityBuilt</code>だったところを<code>onBuildingBuilt</code>に変えています。</p>
<p><a href="http://modiki.civfanatics.com/index.php?title=CvEventManager">イベントのリスト</a>からonBuildingBuiltを探すと、</p>
<blockquote>
</blockquote>
<pre><code class="language-nohighlight" data-lang="nohighlight">Function: def onBuildingBuilt()
Parameters: self, argsList (pCity, iBuildingType)
Description: Called when a building is built
</code></pre><p>となっています。<br>
argsListに2つの値が入っているようです。例えば、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span>
pCity <span style="color:#f92672">=</span> argsList[<span style="color:#ae81ff">0</span>]
iBuildingType <span style="color:#f92672">=</span> argsList[<span style="color:#ae81ff">1</span>]
<span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span>
</code></pre></div><p>などとして取り出すことができます。今回はこの<code>[0]</code>とか<code>[1]</code>とかいう書き方について。</p>
<h1 id="今日の理論編">今日の理論編</h1>
<p>Python実行環境を用意しましょう。<br>
一応埋め込みも置いておきます。</p>
<iframe src="https://paiza.io/projects/e/WmGaoo_zPs6GaaW9LGFx0A?theme=twilight" width="100%" height="500" scrolling="no" seamless="seamless"></iframe>
<h2 id="リスト">リスト</h2>
<p><strong>リスト</strong>とは、<strong>要素</strong>を順番に並べたもののことです。次のようにして作成します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">a <span style="color:#f92672">=</span> [<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">11</span>]
</code></pre></div><p>それぞれの<strong>要素</strong>は<strong>0番目</strong>・<strong>1番目</strong>・<strong>2番目</strong>&hellip;&hellip;と順番が割り当てられていて、<br>
<code>a[2]</code>として<strong>2番目</strong>を取り出すことができます。<br>
試してみましょう。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">a <span style="color:#f92672">=</span> [<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">11</span>]
<span style="color:#66d9ef">print</span> a[<span style="color:#ae81ff">0</span>]
<span style="color:#66d9ef">print</span> a[<span style="color:#ae81ff">1</span>]
<span style="color:#66d9ef">print</span> a[<span style="color:#ae81ff">2</span>]
<span style="color:#66d9ef">print</span> a[<span style="color:#ae81ff">3</span>]
<span style="color:#66d9ef">print</span> a[<span style="color:#ae81ff">4</span>]
</code></pre></div><p>何が出力されるでしょうか。予想して、実行してみましょう。<br>
この番号の部分を<strong>インデックス</strong>(index)と呼びます。</p>
<p><strong>インデックス</strong>は数値ですが、「整数を表すなにか」であれば<br>
整数そのものである必要はありません。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f</span>(x):
    <span style="color:#66d9ef">return</span> x<span style="color:#f92672">*</span>x

a <span style="color:#f92672">=</span> [<span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">29</span>, <span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">37</span>]
b <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
<span style="color:#66d9ef">print</span> a[<span style="color:#ae81ff">1</span>]    <span style="color:#75715e"># 数値</span>
<span style="color:#66d9ef">print</span> a[b]    <span style="color:#75715e"># 数値入り変数</span>
<span style="color:#66d9ef">print</span> a[f(<span style="color:#ae81ff">2</span>)] <span style="color:#75715e"># 関数の戻り値</span>
</code></pre></div><p>頑張って予想しましょう。<br>
<code>a = [13, 17, 23, 29, 31, 37]</code>とあることから、</p>
<ul>
<li>0番目: 13</li>
<li>1番目: 17</li>
<li>2番目: 23</li>
<li>3番目: 29</li>
<li>4番目: 31</li>
<li>5番目: 37</li>
</ul>
<p>となっています(番号は0から始まるのでした)。</p>
<p><code>a[1]</code>は直接1番目の要素を参照していますから<code>17</code>ですね。<br>
<code>b</code>は<code>5</code>ですから、<code>a[b]</code>はaの5番目の要素を指すはずです。<code>37</code>ですね。</p>
<p><code>f(2)</code>は何でしょうか。関数の定義の部分に戻ってみると、<br>
引数の<code>x</code>を<code>x*x</code>にして返しているようです。<br>
いま、引数に<code>2</code>を渡していますから2*2で<code>4</code>ですね。<br>
呼び出した部分がそのまま戻り値である<code>4</code>に置き換わるのでしたから<br>
<code>a[4]</code>となり、<code>31</code>になります。<br>
さて予想もできたところで本当にそうなるか実行してみましょう。</p>
<p>要素数が十分少ないなら、左辺を<code>,</code>で区切って順番に全て取り出すこともできます。</p>
<!-- シーケンス型(正確に言えばiterableな型)のunpack。概念は難しいがイディオムとして便利なのでここで紹介。 -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">a <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">apple</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">orange</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">banana</span><span style="color:#e6db74">&#34;</span>]
e, f, g <span style="color:#f92672">=</span> a
<span style="color:#66d9ef">print</span> e
<span style="color:#66d9ef">print</span> f
<span style="color:#66d9ef">print</span> g
</code></pre></div><p>予想して、実行してみましょう。</p>
<h2 id="繰り返し">繰り返し</h2>
<p>どうせ全要素printするのなら、「リストの各要素に対して、」という表現があれば便利です。<br>
というわけで、<strong>for文</strong>がそれにあたります。<br>
例えばこのように書きます。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fib <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">34</span>]
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> fib:
    <span style="color:#66d9ef">print</span> i
</code></pre></div><p><code>fib</code>の要素を1つずつ取り出して<code>i</code>に代入しつつ、中のブロックを実行します。<br>
ブロックを実行し終わったらまた次の要素を<code>i</code>に代入して、中のブロックを実行します。<br>
これを、リストの要素が尽きるまで&quot;繰り返し&quot;ます。<br>
上のプログラムを実行して動作を確かめてみましょう。</p>
<p>リストの内容分繰り返したいのではなく、ただ単に10回繰り返したいときもあるでしょう。<br>
10個の要素を持ったリストを手作りすればよいのですが、めんどくさいですし、<br>
数え間違いなどが起こってもいやですので、<code>range()</code>という関数を使います。<br>
これは、0以上n未満の整数のリストを作って返してくれます。</p>
<p>動作を見てみましょう。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span> range(<span style="color:#ae81ff">15</span>)
</code></pre></div><p>中の数字をいろいろいじっていろいろ実行してみるとよいでしょう。<br>
(なるほどなるほどー。)</p>
<p>これを使って、このように書けます。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>):
    <span style="color:#66d9ef">print</span> i, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">banme</span><span style="color:#e6db74">&#34;</span>
</code></pre></div><p><code>range()</code>の動作をいろいろ試した方なら、予想できるかもしれません。<br>
予想してから、実行してみましょう。</p>
<p>for文を学んだことで、例えばもし、<br>
「タイル上のユニット数を取得する関数」と、<br>
「i番目のユニットを取得する関数」があったなら、<br>
このように書けるはずです。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nUnits <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">ユ</span><span style="color:#960050;background-color:#1e0010">ニ</span><span style="color:#960050;background-color:#1e0010">ッ</span><span style="color:#960050;background-color:#1e0010">ト</span><span style="color:#960050;background-color:#1e0010">数</span><span style="color:#960050;background-color:#1e0010">を</span><span style="color:#960050;background-color:#1e0010">取</span><span style="color:#960050;background-color:#1e0010">得</span>
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(nUnits):
    pUnit <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">ユ</span><span style="color:#960050;background-color:#1e0010">ニ</span><span style="color:#960050;background-color:#1e0010">ッ</span><span style="color:#960050;background-color:#1e0010">ト</span><span style="color:#960050;background-color:#1e0010">取</span><span style="color:#960050;background-color:#1e0010">得</span>(i)
    pUnit<span style="color:#f92672">.</span><span style="color:#960050;background-color:#1e0010">い</span><span style="color:#960050;background-color:#1e0010">ろ</span><span style="color:#960050;background-color:#1e0010">い</span><span style="color:#960050;background-color:#1e0010">ろ</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
</code></pre></div><p><code>nUnits</code>回だけブロックを繰り返しますから、<br>
タイル上の全ユニットになにかしていることになるはずです。<br>
夢が広がりますね。</p>
<h1 id="modへ戻る">MODへ戻る</h1>
<h2 id="onbuildingbuilt">onBuildingBuilt</h2>
<p>というわけで、<code>onBuildingBuilt()</code>の<code>##########</code>より下をこうしてみました&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span>
<span style="color:#75715e">##########</span>
pCity, iBuildingType <span style="color:#f92672">=</span> argsList

<span style="color:#66d9ef">if</span> iBuildingType <span style="color:#f92672">==</span> gc<span style="color:#f92672">.</span>getInfoTypeForString(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">BUILDING_CELTIC_DUN</span><span style="color:#e6db74">&#39;</span>):
    plot <span style="color:#f92672">=</span> pCity<span style="color:#f92672">.</span>plot()

    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range( plot<span style="color:#f92672">.</span>getNumUnits() ):
        pUnit <span style="color:#f92672">=</span> plot<span style="color:#f92672">.</span>getUnit(i)
        pUnit<span style="color:#f92672">.</span>setHasPromotion(gc<span style="color:#f92672">.</span>getInfoTypeForString(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">PROMOTION_DRILL1</span><span style="color:#e6db74">&#39;</span>), True)
        pUnit<span style="color:#f92672">.</span>setHasPromotion(gc<span style="color:#f92672">.</span>getInfoTypeForString(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">PROMOTION_DRILL2</span><span style="color:#e6db74">&#39;</span>), True)
<span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span>
</code></pre></div><p>全体像だけ見てみると、インデントが入れ子になっていることが分かります。<br>
for文も文ですから、if文のブロックの一員にすることができて、<br>
しかしfor文自身の中身ブロックはそれとは区別しなければなりませんから<br>
さらに空白文字を足さなければならないのですね。</p>
<p>さて、<code>argsList</code>が何だったかというと、<code>onBuildingBuilt()</code>においては<br>
<code>[pCity,iBuildingType]</code>という<strong>リスト</strong>なのでした。</p>
<!-- 本当はリストじゃなくてタプルかもしれない。多分リスト。どのみちシーケンス型なので書き方には影響はない。 -->
<p>ので、このようにして取り出すことが<a href="#%E3%83%AA%E3%82%B9%E3%83%88">できるのでした</a>&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span>
pCity <span style="color:#f92672">=</span> argsList[<span style="color:#ae81ff">0</span>]
iBuildingType <span style="color:#f92672">=</span> argsList[<span style="color:#ae81ff">1</span>]
<span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span>
</code></pre></div><p>あるいは</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span>
pCity, iBuildingType <span style="color:#f92672">=</span> argsList
<span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span>
</code></pre></div><p><code>iBuildingType</code>は今まさに建ったその建造物のTypeを表しているので、<br>
それがダンかどうかはこのようにすればわかります&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span>
<span style="color:#66d9ef">if</span> iBuildingType <span style="color:#f92672">==</span> gc<span style="color:#f92672">.</span>getInfoTypeForString(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">BUILDING_CELTIC_DUN</span><span style="color:#e6db74">&#39;</span>):
<span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#f92672">&lt;&lt;</span>
</code></pre></div><p>(<code>gc.getInfoTypeForString()</code>の働きは大丈夫ですね？キーを対応する種類IDに直す関数なのでした)</p>
<p>さて、ゲーム中、各タイルの状況は刻々と変わります。<br>
(上に乗っているユニットや、建っている改善や、道が引かれているか、鉄道はどうか、etc&hellip;)<br>
なのでこれにも例によって新しい名前があります。<strong>Plot</strong>(地点)です。<br>
<strong>Terrain</strong>(地形)や<strong>Improvement</strong>(改善)といったものが<strong>Plot</strong>の制御下にあるほか、<br>
<strong>Unit</strong>や<strong>City</strong>は自分がどこにあるかの情報を<strong>Plot</strong>でもっています。<br>
たとえば<code>PCity.plot()</code>として<code>pCity</code>の<strong>Plot</strong>を取得できます。</p>
<p>そして、<code>plot</code>上にあるユニットの数は<code>plot.getNumUnits()</code>、<br>
<code>plot</code>上の<code>i</code>番目のユニットは<code>plot.getUnit(i)</code>で取得できます。<br>
<code>pUnit = plot.getUnit(i)</code>と受けてあげることで<br>
各<strong>Unit</strong>に操作ができるようになります。</p>
<p>今回は昇進を与えたいのでしたから、<a href="http://civ4bug.sourceforge.net/PythonAPI/index.html">リファレンス</a>のCyUnitからpromotionで探すと&hellip;</p>
<blockquote>
</blockquote>
<pre><code class="language-nohighlight" data-lang="nohighlight">292. VOID setHasPromotion (PromotionType eIndex, BOOL bNewValue)
     void (int (PromotionTypes) eIndex, bool bNewValue)
</code></pre><p>結構たくさんヒットしましたが、「昇進を無償で与える」に該当しそうなのはこれでしょうか。<br>
PromotionType eIndex は例によって昇進の種類IDなのでいいとして、<br>
もうひとつBOOL bNewValueという引数をとっています。<br>
これは昇進を持っている状況を<code>True</code>、持っていない状況を<code>False</code>とみなしているのですね。</p>
<p>つまり「昇進を持つようにする」と「昇進の所持状況を<code>True</code>にする」を同一視しているのです。<br>
もちろん逆に「昇進を剥奪する」と「昇進の所持状況を<code>False</code>にする」が同一視されるわけです。</p>
<p>ここまでわかれば教練Ⅰを持たせられます。<br>
<code>pUnit.setHasPromotion(gc.getInfoTypeForString('PROMOTION_DRILL1'), True)</code>ですね。</p>
<h2 id="kujiraeventmanagerpy">KujiraEventManager.py</h2>
<p>全体でこうなります&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> CvPythonExtensions <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#f92672">import</span> CvEventManager
<span style="color:#f92672">import</span> CvUtil

gc <span style="color:#f92672">=</span> CyGlobalContext()

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyEventManager</span>(CvEventManager<span style="color:#f92672">.</span>CvEventManager, object):

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">onBuildingBuilt</span>(self, argsList):
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Called when a building is built</span><span style="color:#e6db74">&#39;</span>
        super(self<span style="color:#f92672">.</span>__class__, self)<span style="color:#f92672">.</span>onBuildingBuilt(argsList)
        <span style="color:#75715e">##########</span>
        pCity, iBuildingType <span style="color:#f92672">=</span> argsList

        <span style="color:#66d9ef">if</span> iBuildingType <span style="color:#f92672">==</span> gc<span style="color:#f92672">.</span>getInfoTypeForString(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">BUILDING_CELTIC_DUN</span><span style="color:#e6db74">&#39;</span>):
            plot <span style="color:#f92672">=</span> pCity<span style="color:#f92672">.</span>plot()

            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range( plot<span style="color:#f92672">.</span>getNumUnits() ):
                pUnit <span style="color:#f92672">=</span> plot<span style="color:#f92672">.</span>getUnit(i)
                pUnit<span style="color:#f92672">.</span>setHasPromotion(gc<span style="color:#f92672">.</span>getInfoTypeForString(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">PROMOTION_DRILL1</span><span style="color:#e6db74">&#39;</span>), True)
                pUnit<span style="color:#f92672">.</span>setHasPromotion(gc<span style="color:#f92672">.</span>getInfoTypeForString(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">PROMOTION_DRILL2</span><span style="color:#e6db74">&#39;</span>), True)

</code></pre></div><h2 id="ためす">ためす</h2>
<p>起動して、ユニットを貯めて、ダンを建てて&hellip;<br>
<a href="https://gforestshade.github.io/kujira/img/civss_kujira_for_10.png"><img src="https://gforestshade.github.io/kujira/img/civss_kujira_for_10.png"    /></a>
<br>
できました！</p>
<p><a href="https://gforestshade.github.io/kujira/post/getstarted6/">その６へ続く</a></p>
        </div>
        <div class="col-12">
  
</div>

      </div>

    </div>
  </div>

<footer id="contentinfo" class="footer">
  <address id="about" class="vcard body ml-2">
     <a href="https://gforestshade.github.io/kujira/">Kujira, Civ4 Mod Blog</a>  &copy; 2020 gforest_shade; licenced by <a href="https://creativecommons.org/licenses/by/4.0/deed.ja">CC-BY-4.0</a>
  </address>
</footer>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>

