<!DOCTYPE html>
<html>
  <head>
    <title>はじめてのPythonMOD 3  &middot; Kujira, Civ4 Mod Blog</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="はじめてのPythonMOD, 講座, ">


<meta property="og:title" content="はじめてのPythonMOD 3  &middot; Kujira, Civ4 Mod Blog ">
<meta property="og:site_name" content="Kujira, Civ4 Mod Blog"/>
<meta property="og:url" content="https://gforestshade.github.io/kujira/post/getstarted3/" />
<meta property="og:locale" content="ja-JP">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2017-07-13T00:00:00Z" />
<meta property="og:article:modified_time" content="2017-07-13T00:00:00Z" />

  
    
<meta property="og:article:tag" content="はじめてのPythonMOD">
    
<meta property="og:article:tag" content="講座">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="はじめてのPythonMOD 3" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://gforestshade.github.io/kujira/post/getstarted3/" />
<meta name="twitter:domain" content="https://gforestshade.github.io/kujira/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "はじめてのPythonMOD 3",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2017-07-13",
    "description": "",
    "wordCount": 4133
  }
</script>



<link rel="canonical" href="https://gforestshade.github.io/kujira/post/getstarted3/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://gforestshade.github.io/touch-icon-144-precomposed.png">
<link href="https://gforestshade.github.io/favicon.ico" rel="icon">

<meta name="generator" content="Hugo 0.38.2" />

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
<script defer src="https://use.fontawesome.com/releases/v5.0.10/js/all.js" integrity="sha384-slN8GvtUJGnv6ca26v8EzVaR9DC58QEwsIk9q1QXdCU8Yu8ck/tL/5szYlBbqmS+" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous" />
<link href="https://stackpath.bootstrapcdn.com/bootswatch/4.1.0/materia/bootstrap.min.css" rel="stylesheet" integrity="sha384-BJWCnw/x/9+kQsLGLQDoCX2oJg7j1LjkOfPZWtUPTJ0tn00hYIB5r9u7KnGJxFnY" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night-eighties.min.css" />

<link rel="stylesheet" href="https://gforestshade.github.io/kujira/css/style.css" />

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-111798374-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

    </head>

    <body id="index" class="archive">
      <nav class="navbar navbar-expand-md navbar-dark px-5 navbar-color">
        <a class="navbar-brand" href="https://gforestshade.github.io/kujira/">Kujira, Civ4 Mod Blog</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse"
                data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false"
                aria-label="Toggle navigation">
          &#9776;
        </button>
        <div class="mx-md-4"></div>
        <div class="collapse navbar-collapse" id="navbarNav">
          <div class="nav navbar-nav">
            
            
              <a class="nav-item nav-link menu-item mx-md-2" href="https://gforestshade.github.io/kujira/post/hajimeni/">
              <i class='fa fa-star'></i>
              <span>はじめに</span>
              </a>
            
              <a class="nav-item nav-link menu-item mx-md-2" href="https://gforestshade.github.io/kujira/page/license/">
              <i class='fa fa-file'></i>
              <span>LICENSE</span>
              </a>
            
          </div>
        </div>
      </nav>
      <div class="m-3"></div>

<div id="whole">
  <div class="leftbar">
    




<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a class="collapsed" data-toggle="collapse" href="#collist_0" role="button">目次</a></h5>
  </div>
  <div role="tabpanel" id="collist_0" class="collapse show">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/hajimeni/">はじめに</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a class="collapsed" data-toggle="collapse" href="#collist_1" role="button">Python</a></h5>
  </div>
  <div role="tabpanel" id="collist_1" class="collapse show">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted1/">はじめてのPythonMOD 1</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted2/">はじめてのPythonMOD 2</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted3/">はじめてのPythonMOD 3</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted4/">はじめてのPythonMOD 4</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted5/">はじめてのPythonMOD 5</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted6/">はじめてのPythonMOD 6</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/getstarted7/">はじめてのPythonMOD 7</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy1/">それからのPython 1</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy2/">それからのPython 2</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy3/">それからのPython 3</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy4/">それからのPython 4</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy5/">それからのPython 5</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy6/">それからのPython 6</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy7/">それからのPython 7</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy8/">それからのPython 8</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy9/">それからのPython 9</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/secondpy10/">それからのPython 10</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a data-toggle="collapse" href="#collist_2" role="button">XML</a></h5>
  </div>
  <div role="tabpanel" id="collist_2" class="collapse">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4unitinfos/">CIV4UnitInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4unitclassinfos/">CIV4UnitClassInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/civ4buildinginfos/">CIV4BuildingInfos.xml</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/keyichiran/">XMLキー一覧</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a data-toggle="collapse" href="#collist_3" role="button">C&#43;&#43;</a></h5>
  </div>
  <div role="tabpanel" id="collist_3" class="collapse">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/howtocompile/">CvGameCoreDll.dllの作り方</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a data-toggle="collapse" href="#collist_4" role="button">コラム</a></h5>
  </div>
  <div role="tabpanel" id="collist_4" class="collapse">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/power/">通常電力、きたない電力</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



<div class="card m-3">
  <div class="card-header" role="tab">
    
    <h5 class="mb-0"><a data-toggle="collapse" href="#collist_5" role="button">MMD_to_CIV4</a></h5>
  </div>
  <div role="tabpanel" id="collist_5" class="collapse">
    <div class="list-group list-group-flush">
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/mmd_to_nif/">MMDモデルをCiv4に登場させたい</a>
      
      <a class="list-group-item list-group-item-action" href="https://gforestshade.github.io/kujira/post/nifanimation/">MMDモデルをCiv4上で動かしたい</a>
      
    </div>
    <div class="card-footer p-2"></div>
  </div>
</div>



  </div>
  <div class="centerbar">
    <div class="container-fluid">
            <div class="card card-body my-3">
        <div class="article-title">
          

  
    
    
      
    
      
          <a href="https://gforestshade.github.io/kujira/post/getstarted3/" itemprop="url">
            <img src="https://gforestshade.github.io/kujira/banner/photo_yellow1_1024x200.jpg" class="img-fluid border rounded" alt="Generic responsive image">
          </a>
          
            <p class="banner-license">banner: <a href="https://www.flickr.com/photos/132803717@N02/27004253005/">&lsquo;Choice&rsquo; by Seán Mackey</a> (トリミング) under a <a href="https://creativecommons.org/licenses/by/2.0/deed.ja">Creative Commons Attribution 2.0</a>.</p>
          
      
    
      
    
      
    
      
    
  
  <div class="py-3" ></div>


          <h1 class="article-title">はじめてのPythonMOD 3</h1>
        </div>
        <div class="article-info text-muted d-flex flex-wrap align-items-center align-items-end flex-row justify-content-end mt-1 mb-3">
          <p><time datetime="2017-07-13">2017-07-13 00:00</time></p>
          
          <p>4133  Words</p>
          
          

          
          <p>
            カテゴリ：
            
            <a class="btn btn-sm btn-outline-primary" href="https://gforestshade.github.io/kujira/categories/python">Python</a>
            
          </p>
          

          
          <p>
            タグ：
            
            <a class="btn btn-sm btn-outline-info" href="https://gforestshade.github.io/kujira/tags/%e3%81%af%e3%81%98%e3%82%81%e3%81%a6%e3%81%aepythonmod">はじめてのPythonMOD</a>
            
            <a class="btn btn-sm btn-outline-info" href="https://gforestshade.github.io/kujira/tags/%e8%ac%9b%e5%ba%a7">講座</a>
            
          </p>
          
        </div>
        <div class="article">
          <h1 id="はじめに">はじめに</h1>

<ul>
<li><a href="https://gforestshade.github.io/kujira/post/getstarted2/">その２</a>のつづき<br /></li>
<li>関数について<br />
<br /></li>
</ul>

<h1 id="準備">準備</h1>

<p>Pythonそのものの文法を確かめるのにいちいちCiv4を起動するのでは面倒なので、<br />
小さなPythonプログラムを試せる環境を用意しましょう。<br />
あなたのコンピュータにPythonをインストールしてもよいですし、<br />
現代ではオンライン上で小さなプログラムを試せるサイトもいろいろあるので、<br />
利用させてもらってもよいでしょう。<br />
この記事では<a href="https://paiza.io/">paiza.io</a>を使うことにします。<br />
コード作成画面に入ったら、左上(緑)の言語選択ボタンから<code>Python2</code>を選択し、</p>

<pre><code class="language-python">print 1129
</code></pre>

<p>と入力して、「実行」ボタンを押します。<br />
「出力」のところに<code>1129</code>と出ていればOKです。<br />
<a href="https://gforestshade.github.io/kujira/img/paiza_0.png"><img src="https://gforestshade.github.io/kujira/img/paiza_0.png"    /></a>
</p>

<p></p>

<h1 id="もしくは">もしくは</h1>

<p>埋め込みを置いておくので、ご利用ください。<br />
<iframe src="https://paiza.io/projects/e/WmGaoo_zPs6GaaW9LGFx0A?theme=twilight" width="100%" height="500" scrolling="no" seamless="seamless"></iframe></p>

<h1 id="ちょっとあそぶ">ちょっとあそぶ</h1>

<p>小さいプログラムを書いて遊んでみましょう。</p>

<pre><code class="language-python">a = 5
b = 2
if a &gt; 3:
    b = a * a - 5
print b
</code></pre>

<p>さて、なにが出力されるでしょうか。まず予想を立ててみてください。<br />
予想ができたら、実行してみます。合っていたでしょうか。違っていたでしょうか。</p>

<h1 id="関数">関数</h1>

<p>Pythonでは、ブロックが上から下に順番に実行されるのは先述の通りですが、<br />
処理をまとめておく方法もあります。</p>

<pre><code class="language-python">def doOreore():
    print &quot;oreore,&quot;
    print &quot;oredayo.&quot;

doOreore()
</code></pre>

<p><code>def 関数名():</code>とその直下の<strong>ブロック</strong>が<strong>関数</strong>として<strong>定義</strong>されます。<br />
あとで<code>関数名()</code>とすると関数を「呼び出し」ます。<br />
関数名は(かぶらない限り)自由につけて構いませんが、<br />
その処理のまとまりは要するに全体で何をするものなのか、<br />
動詞っぽいものをつけておく例が多いようです。</p>

<p>関数の旨みのひとつは一度定義すれば何度呼び出しても構わないことにあります。</p>

<pre><code class="language-python">def doOreore2():
    print &quot;oreore,&quot;
    print &quot;oredayo.&quot;

doOreore2()
doOreore2()
doOreore2()
doOreore2()
doOreore2()
</code></pre>

<p>とすると、ひたすら5回もオレオレ詐欺を仕掛けてくるプログラムができるのです。</p>

<h2 id="引数">引数</h2>

<p>関数のさらに強力なところは、値を外から中に持ち込めるところにあります。</p>

<pre><code class="language-python">def doOreore3(son):
    print &quot;oreore,&quot;
    print &quot;oredayo.&quot;
    print son
    print &quot;dayo.&quot;
    print 

doOreore3(&quot;takashi&quot;)
doOreore3(&quot;yuta&quot;)
doOreore3(&quot;jiro&quot;)
doOreore3(&quot;kazuma&quot;)
</code></pre>

<p>(ついてきていますか？焦らず実際に実行しながら進んでくださいね)<br />
定義の時点では変数で記述しておいて、呼び出し時に実際の値を&rdquo;渡し&rdquo;ています。<br />
受け渡しを担当している<code>son</code>のことを<br />
<strong>引数</strong>(ひきすう)あるいは<strong>仮引数</strong>(かりひきすう)と呼びます。</p>

<p>息子の名前だけが違ってあとはほとんど同じ内容をしゃべっていますが、<br />
ほとんど同じな部分をいちいちコピペすることなくほかのお宅に移れるようになっています。</p>

<p>「処理のまとまりに名前が付けられる」という点も強力で、<br />
実際に実行されているのはただのprint文20回分、なのですが、名前があることで<br />
「オレオレ詐欺を4回している」ということが明確になっています。</p>

<p>そういえば、第１回で出てきた<code>pCity.setPopulation(4)</code>と<br />
今回の<code>doOreore3(&quot;takashi&quot;)</code>がすこし似ていますね。</p>

<p>そうです。<code>pCity.setPopulation(4)</code>も関数呼び出しです。<br />
引数に<code>4</code>を渡して呼び出しているのですね。</p>

<p>市民を再配置したり、制覇条件を更新したり&hellip;とめんどくさい内部処理をすべて請け負って<br />
「要するに何をするのか」わかりやすい名前がついていることで、<br />
関数を使う側はやりたいことを素直に記述することに専念できるのです。</p>

<h2 id="戻り値">戻り値</h2>

<p>関数は、呼び出した側に値を投げ返すこともできます。</p>

<pre><code class="language-python">def three():
    return 3

a = three() * 4
print a
</code></pre>

<p>関数内で<code>return 値</code>にたどり着くと、<strong><em>その関数の処理を中断して</em></strong>、<br />
自分を呼び出したところまで戻ってきます。<br />
その際、<code>関数名()</code>という呼び出し文字列全体がその<code>値</code>で置き換わります。<br />
この場合の表記法は数式の関数表記法にならっていますので、<br />
数式をご存知の方は馴染みやすいかもしれません。<br />
このとき投げ返す値のことを<strong>戻り値</strong>と呼びます。<br />
呼び出した側は、投げ返されてきた戻り値をさらに何かに活用することができます。</p>

<p>引数を使って戻り値を計算することもできます。</p>

<pre><code class="language-python">def square(x):
    return x * x

a = square(5)
print a
</code></pre>

<p>(実行してみながらついてきてくださいね)<br />
より数学の関数に近い感じになりました。</p>

<p>ずっとお世話になっている<code>gc.getInfoTypeForString('BUILDING_LIBRARY')</code>はこのタイプの関数です。<br />
キーの文字列を引数に渡して、<br />
それに対応するIDという数値が戻り値として投げ返されるのですね。<br />
わたしたちはその戻り値を変数に代入したり、<br />
直接別の関数の引数として渡したりしていました。</p>

<h1 id="やっとこmod">やっとこMOD</h1>

<p>前回の<code>kujira_if</code>MODをフォルダごとコピーしてリネーム、<code>kujira_def</code>というMODを作ります。</p>

<pre><code class="language-txt">└─kujira_def
    └─Assets
        └─Python
            │─KujiraEventManager.py
            │
            └─Entrypoints
                 └─CvEventInterface.py
</code></pre>

<h2 id="yet-another-防衛志向">Yet Another 防衛志向</h2>

<p>前回は《都市が建設されたとき、その都市の所有者の所属する文明がマリならば、その都市に図書館を建設するMOD》を作りました。<br />
その際、要素をこのように分割しました。</p>

<ul>
<li>都市が建設されたとき<br /></li>
<li>その都市の所有者の所属する文明がマリならば<br /></li>
<li>その都市に図書館を建設する<br />
<br /></li>
</ul>

<p>今回は少し難しくして、<br />
《都市が建設されたとき、所有者の志向が防衛志向ならば、その都市のタイルに弓兵を３体即座に作成するMOD》<br />
を目指します。</p>

<h2 id="kujiraeventmanager-py">KujiraEventManager.py</h2>

<p>というわけで、全体としてこのようなものを目指します&hellip;</p>

<pre><code class="language-python">from CvPythonExtensions import *
import CvEventManager
import CvUtil

gc = CyGlobalContext()

def createUnit(pPlayer, unit, x, y):
    pPlayer.initUnit(unit, x, y, UnitAITypes.NO_UNITAI, DirectionTypes.DIRECTION_SOUTH)

class MyEventManager(CvEventManager.CvEventManager, object):

    def onCityBuilt(self, argsList):
        'Called when a player builds a city'
        super(self.__class__, self).onCityBuilt(argsList)
        ##########
        pCity = argsList[0]
        pPlayer = gc.getPlayer( pCity.getOwner() )
        if pPlayer.hasTrait( gc.getInfoTypeForString('TRAIT_PROTECTIVE') ):
            archerUnit = gc.getInfoTypeForString('UNIT_ARCHER')
            x = pCity.getX()
            y = pCity.getY()
            createUnit(pPlayer, archerUnit, x, y)
            createUnit(pPlayer, archerUnit, x, y)
            createUnit(pPlayer, archerUnit, x, y)
</code></pre>

<h2 id="playerが防衛志向を持つなら">Playerが防衛志向を持つなら</h2>

<p><a href="http://civ4bug.sourceforge.net/PythonAPI/">リファレンス</a>のCyPlayerからtraitを探すと、こうなっています。</p>

<blockquote>
<pre><code class="language-nohighlight">318. BOOL hasTrait (TraitType iIndex)
     bool hasTrait(int /*TraitTypes*/ iIndex) - returns True if player is the Trait Type.
</code></pre>
</blockquote>

<p>つまり、<code>pPlayer.hasTrait(志向の種類ID)</code>とすると、<br />
<strong>Player</strong>がその<strong>志向</strong>を持っているかどうか調べられそうです。</p>

<p>防衛志向の<strong>キー</strong>を<a href="https://gforestshade.github.io/kujira/post/keyichiran/#志向">調べると</a>、<code>TRAIT_PROTECTIVE</code>であることが分かりました。<br />
↓とすると防衛志向のIDが戻るのでした。</p>

<pre><code>gc.getInfoTypeForString('TRAIT_PROTECTIVE')
</code></pre>

<p>↓のように変数に代入しておくこともできますし、</p>

<pre><code>iProtec = gc.getInfoTypeForString('TRAIT_PROTECTIVE')
</code></pre>

<p>↓のように直接引数として渡すこともできます。</p>

<pre><code>pPlayer.hasTrait( gc.getInfoTypeForString('TRAIT_PROTECTIVE') )
</code></pre>

<p>↓下の２つのプログラムは同じ動作をします。</p>

<pre><code class="language-python">if pPlayer.hasTrait( gc.getInfoTypeForString('TRAIT_PROTECTIVE') ):
    'something'
</code></pre>

<pre><code class="language-python">iProtective = gc.getInfoTypeForString('TRAIT_PROTECTIVE')
if pPlayer.hasTrait(iProtective):
    'something'
</code></pre>

<h2 id="弓兵を作成する">弓兵を作成する</h2>

<p><a href="http://civ4bug.sourceforge.net/PythonAPI/">リファレンス</a>のCyPlayerからinitUnitを探すと、こうなっています。</p>

<blockquote>
<pre><code class="language-nohighlight">321. CyUnit initUnit (UnitType iIndex, INT iX, INT iY, UnitAIType eUnitAI, DirectionType eFacingDirection)
     CyUnit* initUnit(UnitTypes iIndex, plotX, plotY, UnitAITypes iIndex) - place Unit at X,Y NOTE: Always use UnitAITypes.NO_UNITAI
</code></pre>
</blockquote>

<p>前半でがんばって勉強したおかげで、これは引数がいっぱいある関数だ！とわかります。<br />
引数をひとつひとつ読んでいきましょう。</p>

<dl>
<dt>UnitType iIndex<br /></dt>
<dd>UnitのTypeとあるのでユニットの種類IDですね。<br />
作りたいユニットのXMLキーを<code>gc.getInfoTypeForString()</code>して<br />
ここに指定すればよさそうです。<br />
<br /></dd>
<dt>INT iX<br /></dt>
<dd>iとあるので数値だということはわかりますが&hellip;Xというのはx座標でしょうか。<br />
これはPlayerに対する操作なのでした。Playerは都市と違い<br />
シド星上に特定の位置を占めているわけではありませんから、<br />
そのユニットがどこに降り立つのか教えてあげないといけないのですね。<br />
<br /></dd>
<dt>INT iY<br /></dt>
<dd>同じくy座標です。今回は都市と同じタイル上に生成されてほしいので、<br />
<code>PCity</code>の座標を取得する方法を探して<br />
取得した座標をそのまま(同じ数値として)指定したらよさそうですね。<br />
<br /></dd>
<dt>UnitAIType eUnitAI<br /></dt>
<dd>UnitAIのTypeなのでユニットAIの種類IDですね(そのまま)。下の行の注釈に<br />
「どんなときでも<code>UnitAITypes.NO_UNITAI</code>を使ってね」<br />
とあるので<code>UnitAITypes.NO_UNITAI</code>を指定しておきましょう。<br />
<br /></dd>
<dt>DirectionType eFacingDirection<br /></dt>
<dd>FacingなDirectionですから「向いている方向」でしょうか。<br />
&hellip;&hellip;&hellip;&hellip;ユニットの向いている方向ですね(そのまま)。<br />
DirectionTypeとあるのでこれまた数値指定ですが、<br />
<a href="http://civ4bug.sourceforge.net/PythonAPI/">リファレンスページ</a>上でDirectionTypeのリンクをクリックすると、<br />
どのようなキーと数値の対応になっているかの一覧が表示されます。<br />
今回はとくに方向を気にしないので、<br />
<code>DirectionTypes.NO_DIRECTION</code>を指定しましょう。<br />
<br /></dd>
</dl>

<p>なお、<code>UnitAITypes.NO_UNITAI</code>や<code>DirectionTypes.NO_DIRECTION</code>は<br />
<strong>関数</strong>ではなく<strong>変数</strong>です。わざわざキーから変換しなくても、<br />
それに対応する数値があらかじめ代入されて提供されています。<br />
ありがたく利用しましょう。</p>

<h2 id="自分で関数を定義する">自分で関数を定義する</h2>

<p><code>pPlayer.initUnit()</code>を呼び出すだけの関数<code>createUnit()</code>を定義してみましょう&hellip;</p>

<pre><code class="language-python">def createUnit(pPlayer, unit, x, y):
    pPlayer.initUnit(unit, x, y, UnitAITypes.NO_UNITAI, DirectionTypes.DIRECTION_SOUTH)
</code></pre>

<p>どのPlayer、どのUnit、どこのx座標、どこのy座標 を引数として受け取っています。<br />
別の言い方をすれば、ここではそれらを決めずに、呼び出す側が決める、ということです。</p>

<p>呼び出し側は、例えばこうなります&hellip;</p>

<pre><code class="language-python">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
archerUnit = gc.getInfoTypeForString('UNIT_ARCHER')
x = pCity.getX()
y = pCity.getY()
createUnit(pPlayer, archerUnit, x, y)
createUnit(pPlayer, archerUnit, x, y)
createUnit(pPlayer, archerUnit, x, y)
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
</code></pre>

<p>さて、すこし想像力が必要かもしれません。<br />
前半3行では弓兵のユニット種ID、都市のx座標、都市のy座標を変数に代入していますね。<br />
それらの<strong>値</strong>をいまさっき<strong>定義</strong>した関数に引数として渡しています。</p>

<p>そうすると、pPlayer=所有者, unit=弓兵のユニットID, x=都市のx座標, y=都市のy座標<br />
に相当する<strong>値</strong>が入った状態で<code>createUnit()</code>(を定義したところ)の<br />
<strong>ブロック</strong>が実行されます。</p>

<p><code>createUnit()</code>の中身に戻ってみてみると、<br />
<strong>ブロック</strong>中では<code>Player.initUnit()</code>を呼び出していて、<br />
都市と同じタイル上に弓兵が生成されますね。</p>

<p><code>createUnit()</code>を3回同じ引数で呼び出していますから、<br />
処理も3回実行され、弓兵が3体できるはずです。</p>

<h2 id="ためす">ためす</h2>

<p><a href="https://gforestshade.github.io/kujira/img/civss_kujira_def_10.png"><img src="https://gforestshade.github.io/kujira/img/civss_kujira_def_10.png"    /></a>
<br />
<a href="https://gforestshade.github.io/kujira/img/civss_kujira_def_11.png"><img src="https://gforestshade.github.io/kujira/img/civss_kujira_def_11.png"    /></a>
<br />
できました！</p>

<p><a href="https://gforestshade.github.io/kujira/post/getstarted4/">その４へ続く</a></p>

<h2 id="余談">余談</h2>

<p>このようなMODを作ったときは、防衛志向に弓が来るかだけでなく、<br />
防衛志向でない指導者には弓が来ないことをちゃんと確認したほうがよいと思います。<br />
防衛志向のみならず金融/哲学に弓が来てしまったら、それはおそらくバグです。<br />
『防衛志向かどうか』の判定がうまくいっていないことを疑う必要があるかもしれません。</p>
        </div>
        <div class="col-12">
  
</div>

      </div>

    </div>
  </div>

<footer id="contentinfo" class="footer">
  <address id="about" class="vcard body">
    &copy; <a href="https://gforestshade.github.io/kujira/">Kujira, Civ4 Mod Blog</a>
  </address>
</footer>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>

